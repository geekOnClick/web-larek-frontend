# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Бизнес логика: ##

## Базовый код:

1. class EventEmitter implements IEvents:
реализация брокера событий, который позволяет объектам подписываться на события и генерировать их. Этот кастомный EventEmitter предоставляет возможность устанавливать обработчики на конкретные события, инициировать события с передачей данных, подписываться на все события или события по шаблону, а также сбрасывать все обработчики.

### Методы: 
- on(eventName: EventName, callback: (data: T) => void): void - устанавливает обработчик на событие.
- off(eventName: EventName, callback: Subscriber): void - снимает обработчик с события.
- emit(eventName: string, data?: T): void - инициирует событие с данными.
- onAll(callback: (event: EmitterEvent) => void): void - подписывается на все события.
- offAll(): void - сбрасывает все обработчики.
- trigger(eventName: string, context?: Partial<T>): (data: T) => void - создает коллбек-триггер, генерирующий событие при вызове.

2. class Api:
Класс Api представляет собой обертку для выполнения HTTP-запросов к API. Он содержит методы для отправки запросов.

### Свойства:
- baseUrl: строка - базовый URL для отправки запросов
- options: объект типа RequestInit - опции запроса, включая заголовки

### Методы:
- constructor(baseUrl: string, options: RequestInit = {}): конструктор класса, принимает базовый URL и опции запроса
- handleResponse(response: Response): Promise<object>: метод для обработки ответа от сервера
- get(uri: string): метод для отправки GET запроса по указанному URI
- post(uri: string, data: object, method: ApiPostMethods = 'POST'): метод для отправки POST запроса с данными по указанному URI (на данный момент по умолчанию)
Также в дальнейшем планируется добавление методов put, delete.

### Типы:
- ApiListResponse<Type>: тип для представления ответа от API, содержащий общее количество элементов и массив элементов указанного типа
- ApiPostMethods: тип для представления допустимых HTTP методов POST, PUT и DELETE

3. abstract class Component<T>:
Класс Component<T> является абстрактным классом, предназначенным для создания компонентов интерфейса. Он содержит методы для управления элементами DOM, установки текста, изображений и состояния элементов.

### Свойства:
- container: защищенное свойство, представляющее контейнер (HTMLElement), в который будет рендериться компонент

### Методы:
- constructor(container: HTMLElement): защищенный конструктор класса, принимает контейнер (HTMLElement), в который будет рендериться компонент
- setText(element: HTMLElement, value: unknown): защищенный метод для установки текстового содержимого элемента
- setImage(element: HTMLImageElement, src: string, alt?: string): защищенный метод для установки изображения в элементе
- setDisabled(element: HTMLElement, state: boolean): метод для установки состояния "disabled" элемента
- render(data?: Partial<T>): HTMLElement: метод для рендеринга компонента с возможностью передачи данных для отображения

## Модель данных:

1. class Product<T> implements IProduct

Класс Product<T> представляет собой модель продукта с основными свойствами и методами для управления данными о продукте.

### Свойства:
- id: строка, идентификатор продукта
- description: строка, описание продукта
- image: строка, путь к изображению продукта
- title: строка, название продукта
- category: строка, категория продукта
- price: число или null, цена продукта
- cartStatus: число, статус продукта в корзине

### Методы:
- constructor(data: Partial<T>, events: IEvents): конструктор класса, принимает частичные данные о продукте и объект событий для обработки событий
- setCartStatus(status: STATUS): метод для установки статуса продукта в корзине

2. class App<T> implements IApp
Класс App<T> представляет собой модель данных всего приложения, содержащую информацию о каталоге продуктов, корзине, заказе и ошибках формы.

### Свойства:
- catalog: массив продуктов из каталога
- cart: массив идентификаторов продуктов в корзине
- cardId: строка, идентификатор выбранного продукта
- order: объект заказа
- formErrors: объект ошибок формы заказа

### Методы:
- constructor(data: Partial<T>, events: IEvents): конструктор класса, принимает частичные данные и объект событий для обработки событий
- setCatalog(items: IProduct[]): метод для установки каталога продуктов
- addToCart(id: string): метод для добавления продукта в корзину
- deleteFromCart(id: string): метод для удаления продукта из корзины
- clearCart(): метод для очистки корзины
- getCatalog(): метод получения каталога.  
- updateCatalog(id: string, action: string): метод для обновления статусов товаров в каталоге.  
- setActiveCardId(item: Product<T>, action: string): метод сохраняет идентификатор карточки товара.  
- getActiveCardId(): метод возвращает идентификатор карточки товара.  
- getTotal(): метод возвращает стоимость всех товаров в корзине.  
- getCartProductList(): метод получает список товаров в корзине.  
- getCartCount(): метод возвращает количество товаров в корзине.  
- setPaymentMethod(method: METHOD): метод сохраняет вариант оплаты.  
- getPaymentMethod(): метод возвращает вариант оплаты.  
- setOrderCart(): метод оформляет текущую корзину в заказ.  
- setOrderTotal(): метод сохраняет текущую стоимость товаров в корзине в заказ.  
- setOrderField(field: keyof IOrderForm, value: string): метод получает и сохраняет данные формы.  
- validateOrder(): метод валидирует данные формы. 

## Кастомное API:

1. class ShopAPI extends Api implements IShopAPI:
Класс кастомного API для выполнения запросов к серверу

### Свойства:
- cdn: свойства для корректного отображения изображения

### Методы:
- getProductList(): метод получает список товаров с сервера.
- getProduct(id: string): метод получает товар с сервера.
- orderProducts(order: IOrder): метод передает заказ серверу.

## Отображение:

1. class Modal extends Component<IModalData>:
Класс модального окна

### Свойства:
- _closeButton: свойство для отображения кнопки закрытия модального окна
- _content: свойство для отображения контента модального окна
+ сеттеры на установку свойств

### Методы:
- open(): метод открытия модального окна.
- close(): метод закрытия модального окна.
- render(): метод рендера элемента.

2. class Card extends Component<IProductItem>
Класс карточки

### Свойства:
- _image: свойство для отображения картинки карточки
- _title: свойство для отображения заголовка карточки
- _category: свойство для отображения категории карточки
- _price: свойство для отображения цены карточки
+ сеттеры на установку свойств

3. class CardModal extends Card
Класс модального окна с карточкой

### Свойства:
- _cardButton: свойство для отображения кнопки модального окна
- _description: свойство для отображения описания
+ сеттеры на установку свойств

4. class Cart extends Component<ICartView>:
Класс корзины

### Свойства:
- _items: свойство для товаров корзины
- _total: свойство для отображения итоговой суммы корзины
- _button: свойство для отображения кнопки корзины
+ сеттеры на установку свойств

4. class CartItem extends Component<ICartItemView>:
Класс элемента корзины

### Свойства:
- _index: свойство индекса товара
- _title: свойство для отображения заголовка товара
- _price: свойство для отображения цены товара
- _deleteButton: свойство для кнопки удаления товара
+ сеттеры на установку свойств

5. class Form<T> extends Component<IFormState>
Класс формы

### Свойства:
- _submit: свойство кнопки отправки формы
- _errors: свойство для отображения ошибок формы
+ сеттеры на установку свойств

### Методы:
- onInputChange(field: keyof T, value: string): метод изменения значения поля формы.
- render(): метод рендера элемента.

6. class FormDetails extends Form<IOrder>
Класс элемента формы - детали заказа

### Свойства:
- _onlineButton: свойство кнопки элемента формы
- _receivedButton: свойство кнопки элемента формы
+ сеттеры на установку свойств

7. class FormContacts extends Form<IOrderForm>
Класс элемента формы - детали заказа

### Свойства:
+ сеттеры на установку свойств

8. class Notification extends Component<ISuccessNotification>
Класс уведомления об успешной покупке

### Свойства:
- _total: свойство отображения итогового списания
- _close: свойство закрытия нотификации
+ сеттеры на установку свойств

9.  class Page extends Component<IPage>
Класс страницы

### Свойства:
- _cart: свойство отображения корзины
- _counter: свойство отображения счетчика товаров
- _catalog: свойство отображения каталога
+ сеттеры на установку свойств

## Взаимодействие компонентов:
Класс ShopApi собирает данные с сервера. После этого класс App получает массив карточек из полученных данных и отправляет его на отрисовку в класс Page. Каждая карточка товара формируется с помощью класса Card. Модальные окна отображаются с использованием класса Modal. При выборе карточки товара открывается её модальное окно. При добавлении товара в корзину с помощью метода класса App он попадает в корзину. При нажатии иконки корзины модальное окно корзины отображается с использованием класса Cart, данные о корзине берутся из класса App. При нажатии кнопки "Оформить" открывается модальное окно формы с помощью класса Form. Данные из формы проходят валидацию в классе App. При успешной валидации данных формы заказ отправляется на сервер с помощью класса ShopApi, а при ошибке валидации выводится сообщение об ошибке в консоли. При успешном ответе от сервера отображается подтверждение заказа с использованием класса Notification.

## Описание типов:

// Описание приложения
 interface IApp {
	catalog: IProductItem[];
	cart: string[];
}

// Описание продукта
 type IProduct = IProductItem & ICartStatus;

// Описание элемента продукта
 interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}

// Описание формы заказа
 interface IOrderForm {
	address: string;
	email: string;
	phone: string;
}

// Описание заказа
 interface IOrder extends IOrderForm {
	payment: METHOD;
	total: number;
	items: string[];
}

// Описание методов заказа
 enum METHOD {
	ONLINE = 'Онлайн',
	RECEIVED = 'При получении',
}

// Описание статусов заказа
 enum STATUS {
	NOT_IN_CART = 0,
	IN_CART = 1,
	NO_PRICE = 2,
}

// Описание статуса корзины
 interface ICartStatus {
	cartStatus: STATUS;
}

// Описание ошибок
 type FormErrors = Partial<Record<keyof IOrder, string>>;

// Описание итога заказа
 interface IOrderResult {
	id: string;
	total: number;
}

## Описание событий:

'catalog:updated': событие обновления каталога
'card:select': событие выбора карточки
'cardModal:open': событие открытия модального окна карточки
'cart:open': событие открытия корзины
'cart:updated': событие обновления корзины
'cartItem:add': событие добавления товара в корзину
'cartItem:delete': событие удалить товар из корзины
'cartItem:select': событие выбора товара
'details:open': событие открытия окна формы подробностей заказа
'details:submit': событие подтверждения формы подробностей заказа
'contacts:submit': событие подтверждения формы контактов
'paymentMethod:change': событие выбора методы оплаты
/^details\.|^contacts\..*:change/: событие изменения полей формы
'formErrors:change': событие ошибки заполнения формы
